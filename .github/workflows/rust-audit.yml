name: "Audit"

on:
  workflow_call:
    inputs:
      name:
        required: true
        type: string

jobs:
  auditable:
    if: "!startsWith(github.event.commits[0].message, 'chore(release): ')"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2

      - run: |
          cargo install --locked cargo-auditable cargo-audit || true
          cargo auditable build --release
          cargo audit bin target/release/${{ inputs.name }}
